name: Keep Render Service Alive

on:
  schedule:
    # Run every 10 minutes (more frequent than UptimeRobot)
    - cron: '*/10 * * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Health Endpoint
        run: |
          echo "Pinging ScamShield API at $(date)"
          response=$(curl -s -o /dev/null -w "%{http_code}" https://scamshield-honeypot.onrender.com/v1/health)
          echo "Response code: $response"
          
          if [ "$response" -eq 200 ]; then
            echo "✅ Service is healthy"
          else
            echo "⚠️ Service returned $response"
            # Try to wake it up with multiple requests
            for i in {1..3}; do
              echo "Attempt $i to wake service..."
              curl -s https://scamshield-honeypot.onrender.com/v1/health
              sleep 5
            done
          fi
      
      - name: Ping Root Endpoint
        run: |
          curl -s https://scamshield-honeypot.onrender.com/ || echo "Root endpoint failed"
      
      - name: Log Status
        run: |
          echo "Keep-alive ping completed at $(date)"
